<div *ngIf="loading">
  <mat-spinner style="margin: 0 auto"></mat-spinner>
  <h5>Estamos buscando seus clientes, aguarde...</h5>
</div>

<div *ngIf="!loading">
  <div fxLayoutAlign="space-between center">
    <button
      mat-dialog-close
      mat-icon-button
      color="accent"
      style="margin: 0 0 20px"
    >
      <mat-icon>highlight_off</mat-icon>
    </button>
    <span mat-dialog-title>{{
      data.title == undefined ? "Novo Agendamento" : "Editar Agendamento"
    }}</span>
    <button
      mat-icon-button
      color="primary"
      style="margin: 0 0 20px"
      [mat-dialog-close]="{
        id: data.id,
        data: data,
        title: title,
        date: dateStart,
        timeStart: timeStart,
        timeEnd: timeEnd,
        paciente_id: customer
      }"
    >
      <mat-icon>done_outline</mat-icon>
    </button>
  </div>

  <div mat-dialog-content style="height: 180px">
    <form fxLayout="column">
      <mat-form-field style="width: 100%">
        <mat-label>Título</mat-label>
        <input
          matInput
          placeholder="Nome do Serviço"
          autocomplete="off"
          type="text"
          [(ngModel)]="title"
          name="title"
          #myInput
        />
      </mat-form-field>

      <mat-form-field style="width: 100%">
        <mat-label>Cliente</mat-label>
        <input
          type="text"
          placeholder="Pesquise um Cliente"
          aria-label="Pesquisa de Cliente"
          matInput
          [formControl]="customerControl"
          [matAutocomplete]="auto"
        />
        <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
          <mat-option
            *ngFor="let option of filteredOptions | async"
            [value]="option.text"
            (click)="customer = option.id"
          >
            {{ option.text }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <div fxFlex fxLayout="row" fxLayoutAlign="space-between center">
        <mat-form-field fxFlex="30">
          <mat-label>Início</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            [(ngModel)]="dateStart"
            name="dateStart"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <mat-form-field fxFlex="30">
          <mat-label>Hora</mat-label>
          <input
            matInput
            type="time"
            [(ngModel)]="timeStart"
            name="timeStart"
          />
        </mat-form-field>

        <mat-form-field fxFlex="30">
          <mat-label>Hora</mat-label>
          <input matInput type="time" [(ngModel)]="timeEnd" name="timeEnd" />
        </mat-form-field>
      </div>
    </form>
  </div>
  <div fxLayoutAlign="end center">
    <button
      *ngIf="data.title != undefined"
      color="warn"
      mat-icon-button
      aria-label="Excluir"
      (click)="onDelete(data)"
    >
      <mat-icon>delete</mat-icon>
    </button>
  </div>
</div>
